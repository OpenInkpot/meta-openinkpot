From 8a55e7d08fb40fcc31fef5cc2ec25512ec11f34f Mon Sep 17 00:00:00 2001
From: Sergiy Kibrik <sakib@meta.ua>
Date: Wed, 9 Oct 2013 20:40:23 +0300
Subject: [PATCH] use native screen resolution

Remove hard-coded 600x800 and use actual X display size
---
 src/main.c |   13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/src/main.c b/src/main.c
index 9b5df49..8618915 100644
--- a/src/main.c
+++ b/src/main.c
@@ -608,6 +608,9 @@ int main(int argc, char** argv)
     if(ecore_config_init("madshelf") != ECORE_CONFIG_ERR_SUCC)
         errx(1, "Unable to initialize Ecore_Config");
 	*/
+
+    if (!ecore_x_init(NULL))
+        errx(1, "Unable to initialize Ecore_X, maybe missing DISPLAY");
     if(!ecore_init())
         errx(1, "Unable to initialize Ecore");
 
@@ -615,6 +618,7 @@ int main(int argc, char** argv)
     {
         ecore_con_shutdown();
         ecore_shutdown();
+        ecore_x_shutdown();
         return 0;
     }
 
@@ -668,7 +672,11 @@ int main(int argc, char** argv)
 
     /* End of state */
 
-    Ecore_Evas* main_win = ecore_evas_software_x11_8_new(0, 0, 0, 0, 600, 800);
+    int width, height;
+    Ecore_X_Screen *screen = ecore_x_default_screen_get();
+    ecore_x_screen_size_get(screen, &width, &height);
+
+    Ecore_Evas* main_win = ecore_evas_software_x11_8_new(0, 0, 0, 0, width, height);
     state.win = main_win;
     ecore_evas_title_set(main_win, "Madshelf");
     ecore_evas_name_class_set(main_win, "Madshelf", "Madshelf");
@@ -683,7 +691,7 @@ int main(int argc, char** argv)
     evas_object_name_set(main_edje, "main_edje");
 
     evas_object_move(main_edje, 0, 0);
-    evas_object_resize(main_edje, 600, 800);
+    evas_object_resize(main_edje, width, height);
 
     /* don't use eoi_fullwindow_object_register -- we need to preserve
        order of edje resizing
@@ -795,6 +803,7 @@ int main(int argc, char** argv)
     evas_shutdown();
     edje_shutdown();
     ecore_shutdown();
+    ecore_x_shutdown();
     //ecore_config_shutdown();
 
     return 0;
-- 
1.7.9.5

