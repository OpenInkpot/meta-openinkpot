From 015d0c31d7304cc32ecefe7c9fe21f3817ac8382 Mon Sep 17 00:00:00 2001
From: Sergiy Kibrik <sakib@meta.ua>
Date: Sat, 5 Oct 2013 08:09:32 +0300
Subject: [PATCH] use native screen resolution

Remove hard-coded 600x800 and use actual X display size
---
 src/gm.c    |   15 +++++++++++----
 src/graph.c |    2 +-
 2 files changed, 12 insertions(+), 5 deletions(-)

diff --git a/src/gm.c b/src/gm.c
index 7853a54..d420ac2 100644
--- a/src/gm.c
+++ b/src/gm.c
@@ -197,9 +197,13 @@ static void main_win_signal_handler(void *param,
     evas_object_del(r);
 }
 
-static void run(bool horizontal)
+static void run(void)
 {
-    Ecore_Evas *main_win = ecore_evas_software_x11_8_new(0, 0, 0, 0, horizontal ? 800 : 600, horizontal ? 600 : 800);
+    int width, height;
+    Ecore_X_Screen *screen = ecore_x_default_screen_get();
+
+    ecore_x_screen_size_get(screen, &width, &height);
+    Ecore_Evas *main_win = ecore_evas_software_x11_8_new(0, 0, 0, 0, width, height);
     gm_socket_server_start(main_win, "gm");
     ecore_evas_title_set(main_win, "GM");
     ecore_evas_name_class_set(main_win, "GM", "GM");
@@ -215,7 +219,7 @@ static void run(bool horizontal)
     edje_object_part_text_set(main_canvas_edje, "footer", "");
     edje_object_part_text_set(main_canvas_edje, "title", "");
     evas_object_move(main_canvas_edje, 0, 0);
-    evas_object_resize(main_canvas_edje, horizontal ? 800 : 600, horizontal? 600 :800);
+    evas_object_resize(main_canvas_edje, width, height);
 
     gm_settings_load();
     gm_graphics_init(main_canvas);
@@ -273,6 +277,8 @@ int main(int argc, char **argv __attribute__((unused)))
 
     setlocale(LC_ALL, "");
     textdomain("gm");
+    if (!ecore_x_init(NULL))
+        die("Unable to initialize Ecore_X, maybe missing DISPLAY\n");
     if(!evas_init())
         die("Unable to initialize Evas\n");
     if(!ecore_init())
@@ -289,7 +295,7 @@ int main(int argc, char **argv __attribute__((unused)))
     ecore_x_io_error_handler_set(exit_all, NULL);
     ecore_event_handler_add(ECORE_EVENT_SIGNAL_EXIT, exit_handler, NULL);
 
-    run(argc > 1);
+    run();
 
     if(_gm_keys)
         keys_free(_gm_keys);
@@ -304,6 +310,7 @@ int main(int argc, char **argv __attribute__((unused)))
     efreet_shutdown();
     ecore_evas_shutdown();
     ecore_shutdown();
+    ecore_x_shutdown();
     evas_shutdown();
     edje_shutdown();
     return 0;
diff --git a/src/graph.c b/src/graph.c
index 2a27aac..40013f1 100644
--- a/src/graph.c
+++ b/src/graph.c
@@ -385,7 +385,7 @@ gm_graphics_init(Evas *evas) {
     int w, h;
     evas_output_size_get(evas, &w, &h);
     Evas_Object *edje = eoi_create_themed_edje(evas, THEME_EDJE,
-        (h > 600) ? "vertical_graphics" : "horizontal_graphics");
+        (h > w) ? "vertical_graphics" : "horizontal_graphics");
     evas_object_name_set(edje, "graphics");
 
     evas_object_move(edje, 0, 0);
-- 
1.7.9.5

